

## Необходимые программы для установки
* Node.js
* npm
* newman
* postman (optional)
----------------------

1. [Подготовка среды. Установка необходимых приложений](#installation)
2. [Содержание тестов](#tests_contains)

    1. [Тесты на загрузку файлов](#tests_upload)
    2. [Тесты для проверок, не вошедших в основной пул](#upload_file_iteration)


### <a name="installation"></a> Подготовка среды в linux (Ubuntu, linux mint)

Для пакетной установки всех файлов перейдите в директорию с проектом и запустите в консоли:
```
env.sh
```
Этот скрипт установит все программы из списка. Чтобы установить программы отдельно, установите:

**node.js**
```
sudo apt install nodejs
```

**npm**

```
sudo apt install -g npm
```

**newman**

Находясь в директории проекта запустите:

```
npm init
```

Для newman я использовала newman-reporter-html отображения отчетов.

```
sudo npm install -g newman-reporter-html
```

**Postman**
Есть несколько способов поставить Postman. Один из них с помощью snap. Для этого сначала поставим snap
```
sudo install snap
```
А затем и сам Postman

```
sudo snap install postman
```
Postman можно установить и [другим способом](https://learning.getpostman.com/docs/postman/launching_postman/installation_and_updates/#linux-installation).


### <a name="tests_contains"></a> Содержание тестов
**<a name="tests_upload"></a> YADisk_upload_file.postman_collection.json**

-- ***получение ссылки - запрос на получение ссылки для загрузки файла***

1. Папка "single iteration" - все тесты для первой итерации (без возможности изменить параметры через файл с данными):

   * To verify Users Ya Disk - проверка, что ЯДиск пуст при первой итерации. При последующих перенаправление на один из запросов в папке "loop get links with different data" в зависимости от подаваемых данных)
   * To get test link for upload - проверка стандартного запроса на получение ссылки для "test.txt" без дополнительных параметров
   * upload test file - загрузка файла по полученной ссылке
   * upload test file without attach - отправка запроса по полученной ссылке без вложения
   * To get link without token - отправка запроса на получение ссылки без токена
   * To get link with invalid token - отправка запроса на получение ссылки с невалидным токеном
   * To get link without headers - отправка запроса на получение ссылки без обязательных заголовков (Accept, Content-Type)
   * To get link with wrong/xml headers - отравка запроса на получение ссылки с невалидными значениями в заголовках (xml вместо json)
   * To get link without required filds - отправка запроса на получение ссылки без обязательных полей

2. Папка "loop get links with different data" с шаблонами запросов на получение ссылки с разными параметрами с использованием данных из файла "upload_data.json":
   * To get link with requiered param - получение ссылки с указанием обязательного параметра и проверка ответа на наличие перечисленных полей
   * To get link with overwrite param - получение ссылки с указанием необязательного параметра "overwrite" (возможность перезаписывать уже имеющийся файл) и проверка ответа на наличие перечисленных полей
   * To get link with fields param - получение ссылки с указанием необязательного параметра "fields" (перечисление полей, которые должны вернуться в ответе) и проверка наличия этих полей в ответе
   * To get link with all param - получение ссылки со всеми параметрами (обязательным - path, необязательными - overwrite, fields) и проверка наличия указанных полей в ответе

3. Upload file - отправка файла по ранее полученной ссылке на загрузку
4. To verify uploaded file - проверка наличия файла в ЯДиске после его загрузки по пути, который отправляли в запросе на получение ссылки

**Структура данных для тестов**

Файл ***upload_data.json*** в формате json может содержать следующие поля:

-- "comment" содержит комментарий к проверке. Создан исключительно для удобства понимания при прочтении файла. Данные в тестах не используются

-- "linkPath" содержит путь к файлу на ЯДиске. Может быть как относительный, так и абсолютный. По документации необходимо использовать путь в формате url.

-- "linkStatusCode" содежит ожидаемый код ответа на запрос для получения ссылки

-- "responseFields" содежит массив названия полей, которые должны присутствовать в ответе на запрос для получения ссылки

-- "method" содежит метод, который должен быть указан в поле "method" в ответе на запрос для получения ссылки. Ключ "method" можно не указывать, если предполагается, что в ответе этого поля не будет

-- "file" - название файла, который будет загружен (без указания пути к этому файлу. Путь ко всем файлам указан отдельно в environment "dev.postman_environment.json"). Ключ "file" можно не указывать, если предполагается, что ссылка не была получена при предыдущем запросе, либо ожидаемый запрос пришел с ошибкой.

-- "uploadStatusCode" содежит код ответа на запрос загрузки файла. Ключ "uploadStatusCode" можно не указывать, если предполагаемый запрос на получение ссылки содержит ошибку или ссылка отсутствует.

-- "linkPath1" содержит первую часть пути к файлу на ЯДиск в том случае, если путь длинный

-- "linkPath2" содержит вторую часть пути к файлу на ЯДиск в том случае, если путь длинный

-- "overwrite" содержит boolean значение. Ключ не указывается в случае, если планируется не передавать значение в параметрах запроса

-- "fields" содежит список полей через запятую, которые должны быть возвращены в ответе. Ключ не указывается, если не планируется передавать этот необязательный параметр в запросе.

**<a name="upload_file_iteration"></a> YADisk_upload_file_iteration.postman_collection.json**

Универсальный пул запросов для следующего вида запросов:

* проверка срока действия ссылки
* проверка загрузки больших файлов
* простая проверка на загрузку файла с минимально обязательными параметрами
* проверка запроса с отложенной отправкой (secTimeOut перед отправкой запроса)

1. To get link - запрос с обязательным параметром ("path") для получения ссылки

2. Upload file - запрос для загрузки файла с вложением

3. To verify uploaded file - запрос для проверки наличия загруженного файла на ЯДиске по пути, указанному в первом запросе


**Структура данных для тестов**

Файл ***data_long_wait_and_large_files.csv*** в формате csv, разделитель запятая. Содержит следующие данные:

-- linkPath - путь до файла в ЯДиске

-- linkStatusCode - ожидаемый код ответа на запрос ссылки

-- timeOut - boolean значение. True указывается, если нужна задержка в отправке запроса. False указывается, если задержка не нужна

-- minTimeOut - время в мин. для задержки отправки запроса. Значение не обрабатывается, если в предыдущей ячейке (timeOut) стоит false. Следовательно, если временная задержка не нужна, поле можно оставить пустым, либо проставить 0

-- secTimeOut - время в сек. для задержки отправки запроса. Значение не обрабатывается, если в предыдущей ячейке (timeOut) стоит false. Следовательно, если временная задержка не нужна, поле можно оставить пустым, либо проставить 0

-- file - название файла с расширением без пути до папки с файлом. Путь указывается отдельно в environment (dev.postman_environment.json)

-- uploadStatusCode - код ответа, который ожидается после загрузки файла
